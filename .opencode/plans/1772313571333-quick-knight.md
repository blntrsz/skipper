# Plan: Re-add ECS task in AWS bootstrap

## Current repo changes (checked)
- `git status --short`: 19 tracked changes + 7 untracked paths.
- AWS area changed heavily: `src/command/aws/template.ts` moved to API Gateway -> EventBridge only.
- ECS resources removed from template (`WebhookEcsCluster`, `WebhookTaskDefinition`, related outputs).
- `src/command/aws/run.ts` now treats EventBridge-only bootstrap stacks as unsupported for `aws run`.

## Recommended implementation
1. Re-add ECS execution resources to bootstrap template, keep EventBridge ingress unchanged.
   - Update `src/command/aws/template.ts`.
   - Restore ECS block (cluster, log group, task exec role, task role, SG, task definition).
   - Keep API Gateway -> EventBridge resources exactly as current.
2. Restore ECS-required template parameters/outputs.
   - Add params needed by ECS networking: `VpcId`, `SubnetIds`.
   - Re-add outputs: `EcsClusterArn`, `EcsTaskDefinitionArn`, `EcsSecurityGroupId`, `EcsSubnetIdsCsv`.
3. Make bootstrap provide network params again.
   - Update `src/command/aws/bootstrap.ts` to discover default VPC/subnets via `discoverDefaultNetwork` + `EC2Client` during deploy path.
   - Extend `createTemplateParameters(...)` to include discovered `VpcId` and CSV `SubnetIds`.
   - Keep `--dry-run-template` path no AWS network calls.
4. Keep `aws run` compatibility output-based.
   - Ensure `src/command/aws/run.ts` accepts stacks when ECS outputs exist, even with EventBridge outputs.
   - Keep error only for EventBridge-only stacks missing ECS outputs.
5. Update tests to match mixed model (EventBridge ingress + ECS runtime).
   - `src/command/aws/template.test.ts`: ECS present; Lambda/SQS still absent.
   - `src/command/aws/bootstrap.test.ts`: `createTemplateParameters` includes `VpcId`/`SubnetIds`.
   - `src/command/aws/run.test.ts`: keep/adjust guard assertions for missing-ECS stacks.

## Critical files to modify
- `src/command/aws/template.ts`
- `src/command/aws/template.test.ts`
- `src/command/aws/bootstrap.ts`
- `src/command/aws/bootstrap.test.ts`
- `src/command/aws/run.ts` (only if guard/message tweak needed)
- `src/command/aws/run.test.ts` (only if run behavior text/guard changes)

## Verification
- `bun test src/command/aws/template.test.ts`
- `bun test src/command/aws/bootstrap.test.ts`
- `bun test src/command/aws/run.test.ts`
- `bun test`

## Unresolved questions
- none
