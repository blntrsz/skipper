# ECS Success Status Plan

## Intent
- User wants ECS task to show `Success` instead of `Stopped` in AWS console.

## Constraints
- AWS ECS console `lastStatus` is AWS-managed lifecycle state; cannot rename `STOPPED` to `Success`.
- Success must be derived from task/container details (`exitCode`, `stoppedReason`, container `reason`).

## Recommended Approach
1. Do not try to change ECS console label.
2. Update `src/command/aws/run.ts` (`waitForTaskStop`) to derive outcome when task reaches `STOPPED`:
   - `exitCode === 0` => log explicit success message (`Task success ...`).
   - non-zero or missing exit code => throw explicit failure error including `exitCode` and reason fields.
3. Add a small pure helper in `src/command/aws/run.ts` for stop outcome formatting/classification (keeps logic testable).
4. Add tests in `src/command/aws/run.test.ts` for:
   - stopped + exit 0 => success
   - stopped + non-zero exit => failure
   - stopped + unknown exit => failure/unknown
5. Optional follow-up: in `src/command/aws/lambda/handler.ts`, add task ARN/outcome correlation logs; if needed later, wire EventBridge ECS Task State Change events for centralized success/fail records.

## Critical Files
- `src/command/aws/run.ts`
- `src/command/aws/run.test.ts`
- `src/command/aws/lambda/handler.ts` (optional follow-up)

## Verification
- Run: `bun test src/command/aws/run.test.ts`
- Run one known-success task via CLI with `--wait`; confirm success wording.
- Run one known-failing task via CLI with `--wait`; confirm non-zero failure with exit/reason in message.
- Confirm ECS console still shows `STOPPED` (expected), while CLI reports derived success/failure.

## Unresolved Questions
- none
