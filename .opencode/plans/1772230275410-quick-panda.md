# Plan: AWS Deploy Command for Skipper

## Overview
Create `aws deploy` command that uses Pulumi to deploy infrastructure:
- Lambda function with Function URL
- AppSync Events for GitHub event subscriptions

## Files to Create

### 1. Infrastructure Code
- `src/command/aws/deploy/infra.ts` - Pulumi infrastructure definitions
- `src/command/aws/deploy/index.ts` - Deploy command implementation
- `src/command/aws/index.ts` - AWS subcommand registration

### 2. Dependencies
Add to `package.json`:
- `@pulumi/pulumi`
- `@pulumi/aws`
- `@pulumi/awsx` (optional, for simplified resources)

## Implementation Details

### infra.ts Structure
```typescript
// Define:
// - Lambda execution role
// - Lambda function (Node.js 20.x runtime)
// - Lambda Function URL (public access)
// - AppSync Events API
// - Event rules/handlers for GitHub webhooks
// - Secrets manager for GitHub tokens
```

### Deploy Command Flow
1. Check for Pulumi CLI installation
2. Create/Select Pulumi stack
3. Run `pulumi up` with the infra code
4. Output deployed URLs and endpoints

### Lambda Handler
Separate file for the actual Lambda function code that processes GitHub events.

## Verification Steps
1. Run `bun run cli aws deploy --help`
2. Execute `bun run cli aws deploy`
3. Verify Lambda created in AWS Console
4. Test Function URL responds
5. Verify AppSync Events API created

## Open Questions
- Should the deploy command accept stack name parameter? (default: "prod")
- Should it support --preview flag to show changes without applying?
- Lambda runtime: Node.js 20.x vs Bun runtime?
